<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Updater WebSocket Test</title>
    <style>
        body {
            font-family: monospace;
            background: #121212;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: #00ff99;
        }

        #log {
            width: 80%;
            max-width: 800px;
            height: 400px;
            background: #1e1e1e;
            border: 1px solid #333;
            overflow-y: auto;
            padding: 10px;
            margin-top: 20px;
            white-space: pre-wrap;
        }

        button {
            margin: 5px;
            padding: 8px 16px;
            background: #00ff99;
            border: none;
            border-radius: 4px;
            color: #000;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background: #00cc77;
        }
    </style>
</head>

<body>
    <h1>Updater WebSocket Test</h1>
    <div>
        <button id="connectBtn">Connect</button>
        <button id="startBtn">Start Updater</button>
        <button id="stopBtn">Stop Updater</button>
    </div>
    <div id="log">Waiting for connection...</div>

    <script>
        let ws;

        function log(msg) {
            const logBox = document.getElementById("log");
            logBox.textContent += "\n" + msg;
            logBox.scrollTop = logBox.scrollHeight;
        }

        function connect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                log("Already connected.");
                return;
            }

            ws = new WebSocket("ws://localhost:3000/ws/updater");

            ws.onopen = () => log("[Connected to /ws/updater]");
            ws.onmessage = (e) => log("[Update] " + e.data);
            ws.onclose = () => log("[Connection closed]");
            ws.onerror = (err) => log("[Error] " + err.message);
        }

        document.getElementById("connectBtn").onclick = connect;

        document.getElementById("startBtn").onclick = () => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send("START");
                log("> START command sent");
            } else {
                log("WebSocket not connected.");
            }
        };

        document.getElementById("stopBtn").onclick = () => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send("STOP");
                log("> STOP command sent");
            } else {
                log("WebSocket not connected.");
            }
        };
    </script>
</body>

</html>
